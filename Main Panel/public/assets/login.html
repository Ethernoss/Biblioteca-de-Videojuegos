<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link rel="stylesheet" href="../../src/styles/styleslogin.css" />
  </head>
  <body>
    <!-- Navbar transparente -->
    <nav class="navbar">
      <div class="navbar-buttons">
        <button class="navbar-btn">Sign In</button>
        <button class="navbar-btn" onclick="openModal('register')">
          Register
        </button>
      </div>
    </nav>

    <main>
      <!-- Contenedor de Login -->
      <div class="login-container" id="loginContainer">
        <h1>Welcome back!</h1>
        <form>
          <input
            type="text"
            placeholder="Usuario"
            class="input-field"
            required
          />
          <input
            type="password"
            placeholder="Contraseña"
            class="input-field"
            required
          />
          <button type="submit" class="shadow__btn">Entrar</button>
        </form>
        <p>
          ¿No tienes una cuenta?
          <span class="register-link" onclick="openModal('register')"
            >Regístrate aquí</span
          >
        </p>
      </div>

      <!-- Modal de Registro -->
      <div class="modal" id="registerModal">
        <div class="modal-content">
          <span class="close-btn" onclick="closeModal('register')"
            >&times;</span
          >
          <h1>Regístrate</h1>
          <form>
            <input
              type="text"
              placeholder="Usuario"
              class="input-field"
              required
            />
            <input
              type="email"
              placeholder="Correo Electrónico"
              class="input-field"
              required
            />
            <input
              type="password"
              placeholder="Contraseña"
              class="input-field"
              required
            />
            <input
              type="password"
              placeholder="Confirmar Contraseña"
              class="input-field"
              required
            />
            <button type="submit" class="shadow__btn">Registrar</button>
          </form>
        </div>
      </div>
    </main>

    <script>
      // Abrir el modal
      function openModal(modalType) {
        const loginContainer = document.getElementById("loginContainer");
        const registerModal = document.getElementById("registerModal");

        if (modalType === "register") {
          // Ocultar el modal de login
          loginContainer.style.display = "none";
          // Mostrar el modal de registro
          registerModal.style.display = "flex"; // Cambiar a flex para centrarlo
        }
      }

      // Cerrar el modal
      function closeModal(modalType) {
        const loginContainer = document.getElementById("loginContainer");
        const registerModal = document.getElementById("registerModal");

        if (modalType === "register") {
          // Mostrar de nuevo el modal de login y cerrar el de registro
          loginContainer.style.display = "block";
          registerModal.style.display = "none";
        }
      }

      // Registro de usuario
      document
        .querySelector("#registerModal form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const username = document.querySelector(
            "#registerModal input[placeholder='Usuario']"
          ).value;
          const email = document.querySelector(
            "#registerModal input[placeholder='Correo Electrónico']"
          ).value;
          const password = document.querySelector(
            "#registerModal input[placeholder='Contraseña']"
          ).value;
          const confirmPassword = document.querySelector(
            "#registerModal input[placeholder='Confirmar Contraseña']"
          ).value;

          if (password !== confirmPassword) {
            alert("Las contraseñas no coinciden");
            return;
          }

          try {
            const response = await fetch("/api/games/register", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                username,
                email,
                password,
                isAdmin: false,
              }),
            });

            if (response.ok) {
              alert("Usuario registrado exitosamente");
              closeModal("register");
            } else {
              const { message } = await response.json();
              alert(message);
            }
          } catch (error) {
            alert("Error al registrar usuario");
          }
        });

      // Login de usuario
      document
        .querySelector("#loginContainer form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          // Cambiar 'email' por 'username' en el selector y nombre de variable
          const username = document.querySelector(
            "#loginContainer input[placeholder='Usuario']"
          ).value;
          const password = document.querySelector(
            "#loginContainer input[placeholder='Contraseña']"
          ).value;

          try {
            const response = await fetch("/api/games/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }), // Asegúrate de enviar 'username'
            });

            if (response.ok) {
              const { message, redirect } = await response.json();
              alert(message);
              window.location.href = redirect;
            } else {
              const { message } = await response.json();
              alert(message);
            }
          } catch (error) {
            alert("Error al iniciar sesión");
          }
        });
    </script>
  </body>
</html>
